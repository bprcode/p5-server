import"./_commonjsHelpers-9f0e44cc.js";import{g as ie,a as ae,s as ce,b as M,r as x,u as le,_ as de,j as t,c as ue,d as pe,f as O,E as ke,G as z,H,e as Me,i as Ne,J as me,T as w,B as C,y as xe,K as $e,k as L,M as Re,h as Te,C as Q,N as Fe,I as ge,S as $,D as re,P as Z,o as D,m as B,l as Y,O as he,p as Le,U as De,z as Ee,A as Oe,Q as Ie,x as We,R as _e}from"./debounce-02451237.js";import{c as X,A as Pe,u as E,d as Ge,C as K,e as fe,a as ve,b as ze,f as Qe,S as U,Q as Be,g as Ke,M as Ue}from"./AddCircleOutline-f0a69d24.js";function qe(e){return ie("MuiCardMedia",e)}ae("MuiCardMedia",["root","media","img"]);const Ae=["children","className","component","image","src","style"],Ve=e=>{const{classes:n,isMediaComponent:r,isImageComponent:o}=e;return pe({root:["root",r&&"media",o&&"img"]},qe,n)},Je=ce("div",{name:"MuiCardMedia",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:r}=e,{isMediaComponent:o,isImageComponent:s}=r;return[n.root,o&&n.media,s&&n.img]}})(({ownerState:e})=>M({display:"block",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center"},e.isMediaComponent&&{width:"100%"},e.isImageComponent&&{objectFit:"cover"})),He=["video","audio","picture","iframe","img"],Ze=["picture","img"],Ye=x.forwardRef(function(n,r){const o=le({props:n,name:"MuiCardMedia"}),{children:s,className:i,component:a="div",image:d,src:l,style:c}=o,m=de(o,Ae),u=He.indexOf(a)!==-1,p=!u&&d?M({backgroundImage:`url("${d}")`},c):c,h=M({},o,{component:a,isMediaComponent:u,isImageComponent:Ze.indexOf(a)!==-1}),j=Ve(h);return t.jsx(Je,M({className:ue(j.root,i),as:a,role:!u&&d?"img":void 0,ref:r,style:p,ownerState:h,src:u?d||l:void 0},m,{children:s}))}),Xe=Ye,et=x.createContext(),oe=et;function tt(e){return ie("MuiGrid",e)}const nt=[0,1,2,3,4,5,6,7,8,9,10],rt=["column-reverse","column","row-reverse","row"],ot=["nowrap","wrap-reverse","wrap"],W=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],st=ae("MuiGrid",["root","container","item","zeroMinWidth",...nt.map(e=>`spacing-xs-${e}`),...rt.map(e=>`direction-xs-${e}`),...ot.map(e=>`wrap-xs-${e}`),...W.map(e=>`grid-xs-${e}`),...W.map(e=>`grid-sm-${e}`),...W.map(e=>`grid-md-${e}`),...W.map(e=>`grid-lg-${e}`),...W.map(e=>`grid-xl-${e}`)]),_=st,it=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function F(e){const n=parseFloat(e);return`${n}${String(e).replace(String(n),"")||"px"}`}function at({theme:e,ownerState:n}){let r;return e.breakpoints.keys.reduce((o,s)=>{let i={};if(n[s]&&(r=n[s]),!r)return o;if(r===!0)i={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(r==="auto")i={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const a=z({values:n.columns,breakpoints:e.breakpoints.values}),d=typeof a=="object"?a[s]:a;if(d==null)return o;const l=`${Math.round(r/d*1e8)/1e6}%`;let c={};if(n.container&&n.item&&n.columnSpacing!==0){const m=e.spacing(n.columnSpacing);if(m!=="0px"){const u=`calc(${l} + ${F(m)})`;c={flexBasis:u,maxWidth:u}}}i=M({flexBasis:l,flexGrow:0,maxWidth:l},c)}return e.breakpoints.values[s]===0?Object.assign(o,i):o[e.breakpoints.up(s)]=i,o},{})}function ct({theme:e,ownerState:n}){const r=z({values:n.direction,breakpoints:e.breakpoints.values});return H({theme:e},r,o=>{const s={flexDirection:o};return o.indexOf("column")===0&&(s[`& > .${_.item}`]={maxWidth:"none"}),s})}function ye({breakpoints:e,values:n}){let r="";Object.keys(n).forEach(s=>{r===""&&n[s]!==0&&(r=s)});const o=Object.keys(e).sort((s,i)=>e[s]-e[i]);return o.slice(0,o.indexOf(r))}function lt({theme:e,ownerState:n}){const{container:r,rowSpacing:o}=n;let s={};if(r&&o!==0){const i=z({values:o,breakpoints:e.breakpoints.values});let a;typeof i=="object"&&(a=ye({breakpoints:e.breakpoints.values,values:i})),s=H({theme:e},i,(d,l)=>{var c;const m=e.spacing(d);return m!=="0px"?{marginTop:`-${F(m)}`,[`& > .${_.item}`]:{paddingTop:F(m)}}:(c=a)!=null&&c.includes(l)?{}:{marginTop:0,[`& > .${_.item}`]:{paddingTop:0}}})}return s}function dt({theme:e,ownerState:n}){const{container:r,columnSpacing:o}=n;let s={};if(r&&o!==0){const i=z({values:o,breakpoints:e.breakpoints.values});let a;typeof i=="object"&&(a=ye({breakpoints:e.breakpoints.values,values:i})),s=H({theme:e},i,(d,l)=>{var c;const m=e.spacing(d);return m!=="0px"?{width:`calc(100% + ${F(m)})`,marginLeft:`-${F(m)}`,[`& > .${_.item}`]:{paddingLeft:F(m)}}:(c=a)!=null&&c.includes(l)?{}:{width:"100%",marginLeft:0,[`& > .${_.item}`]:{paddingLeft:0}}})}return s}function ut(e,n,r={}){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return[r[`spacing-xs-${String(e)}`]];const o=[];return n.forEach(s=>{const i=e[s];Number(i)>0&&o.push(r[`spacing-${s}-${String(i)}`])}),o}const pt=ce("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:r}=e,{container:o,direction:s,item:i,spacing:a,wrap:d,zeroMinWidth:l,breakpoints:c}=r;let m=[];o&&(m=ut(a,c,n));const u=[];return c.forEach(p=>{const h=r[p];h&&u.push(n[`grid-${p}-${String(h)}`])}),[n.root,o&&n.container,i&&n.item,l&&n.zeroMinWidth,...m,s!=="row"&&n[`direction-xs-${String(s)}`],d!=="wrap"&&n[`wrap-xs-${String(d)}`],...u]}})(({ownerState:e})=>M({boxSizing:"border-box"},e.container&&{display:"flex",flexWrap:"wrap",width:"100%"},e.item&&{margin:0},e.zeroMinWidth&&{minWidth:0},e.wrap!=="wrap"&&{flexWrap:e.wrap}),ct,lt,dt,at);function mt(e,n){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return[`spacing-xs-${String(e)}`];const r=[];return n.forEach(o=>{const s=e[o];if(Number(s)>0){const i=`spacing-${o}-${String(s)}`;r.push(i)}}),r}const xt=e=>{const{classes:n,container:r,direction:o,item:s,spacing:i,wrap:a,zeroMinWidth:d,breakpoints:l}=e;let c=[];r&&(c=mt(i,l));const m=[];l.forEach(p=>{const h=e[p];h&&m.push(`grid-${p}-${String(h)}`)});const u={root:["root",r&&"container",s&&"item",d&&"zeroMinWidth",...c,o!=="row"&&`direction-xs-${String(o)}`,a!=="wrap"&&`wrap-xs-${String(a)}`,...m]};return pe(u,tt,n)},gt=x.forwardRef(function(n,r){const o=le({props:n,name:"MuiGrid"}),{breakpoints:s}=O(),i=ke(o),{className:a,columns:d,columnSpacing:l,component:c="div",container:m=!1,direction:u="row",item:p=!1,rowSpacing:h,spacing:j=0,wrap:y="wrap",zeroMinWidth:f=!1}=i,S=de(i,it),g=h||j,R=l||j,N=x.useContext(oe),T=m?d||12:N,v={},P=M({},S);s.keys.forEach(G=>{S[G]!=null&&(v[G]=S[G],delete P[G])});const ne=M({},i,{columns:T,container:m,direction:u,item:p,rowSpacing:g,columnSpacing:R,wrap:y,zeroMinWidth:f,spacing:j},v,{breakpoints:s.keys}),Ce=xt(ne);return t.jsx(oe.Provider,{value:T,children:t.jsx(pt,M({ownerState:ne,className:ue(Ce.root,a),as:c,ref:r},P))})}),q=gt;var ht=function(){return null};var ee={},ft=Ne;Object.defineProperty(ee,"__esModule",{value:!0});var je=ee.default=void 0,vt=ft(Me()),yt=t,jt=(0,vt.default)((0,yt.jsx)("path",{d:"m18.85 10.39 1.06-1.06c.78-.78.78-2.05 0-2.83L18.5 5.09c-.78-.78-2.05-.78-2.83 0l-1.06 1.06 4.24 4.24zm-5.66-2.83L4 16.76V21h4.24l9.19-9.19-4.24-4.25zM19 17.5c0 2.19-2.54 3.5-5 3.5-.55 0-1-.45-1-1s.45-1 1-1c1.54 0 3-.73 3-1.5 0-.47-.48-.87-1.23-1.2l1.48-1.48c1.07.63 1.75 1.47 1.75 2.68zM4.58 13.35C3.61 12.79 3 12.06 3 11c0-1.8 1.89-2.63 3.56-3.36C7.59 7.18 9 6.56 9 6c0-.41-.78-1-2-1-1.26 0-1.8.61-1.83.64-.35.41-.98.46-1.4.12-.41-.34-.49-.95-.15-1.38C3.73 4.24 4.76 3 7 3s4 1.32 4 3c0 1.87-1.93 2.72-3.64 3.47C6.42 9.88 5 10.5 5 11c0 .31.43.6 1.07.86l-1.49 1.49z"}),"Draw");je=ee.default=jt;function V({spin:e,text:n}){return e?t.jsx(X,{size:"1.5rem"}):n}function St({onLogout:e,onGetStarted:n,isLoggingOut:r,user:o}){const s=O(),i=me("(max-width: 320px)");let a=t.jsx(t.Fragment,{});return o?a=t.jsxs(t.Fragment,{children:[t.jsx(Pe,{alt:o.name,sx:{mr:2,backgroundColor:s.palette.secondary.main,display:["none","inherit"]},children:[...o.name][0]}),t.jsxs(w,{sx:{display:["none","inherit"]},children:["Welcome, ",o.name||o.email]}),t.jsx(C,{onClick:e,color:"secondary",sx:{ml:4},children:t.jsx(V,{spin:r,text:"Logout"})})]}):a=t.jsx(t.Fragment,{children:t.jsx(C,{variant:"contained",onClick:n,sx:{display:i?"none":void 0},children:"Get Started"})}),t.jsx(xe,{theme:$e,children:t.jsx(L,{sx:{flexGrow:1,borderBottom:`1px solid ${s.palette.background.default}`},children:t.jsx(Re,{position:"static",sx:{backgroundColor:Te(s.palette.background.default,.3),backdropFilter:"blur(3px)"},children:t.jsx(Q,{maxWidth:"lg",disableGutters:!0,children:t.jsxs(Fe,{children:[t.jsx(ge,{size:"large",edge:"start",color:"inherit","aria-label":"menu",alt:"writing pencil",sx:{display:["none","block"]},children:t.jsx(je,{})}),t.jsxs(L,{sx:{flexGrow:1},children:[t.jsx(w,{variant:"h6",component:"span",fontWeight:"bold",children:"Note"}),t.jsx(w,{variant:"h6",component:"span",fontWeight:"light",children:"Scribbler"})]}),a]})})})})})}const bt="/assets/aurora-gradient-2x-71ce0c50.png",wt="/assets/aurora-gradient-small-50b52e20.png",te=x.createContext(null),Se=x.createContext(null);function Ct(e,n){const r=new Map(e);switch(n.type){case"set":return r.set(n.id,{message:n.message,color:n.color||"blue"});case"deleted":return r.delete(n.id),r;default:throw Error("Unrecognized action type: "+n.type)}}function kt(){x.useContext(te)}function Mt(e){let n;for(;;)if(n=(Math.random()*1e3).toFixed(0),!e.has(n))return n}async function se(e,n,r){if(!e.resource)throw Error("No resource specified for request.");const o=e.resource,s=Mt(n),i=e.method||"GET",a=`(${s}) `+i+" > "+o.replace("https://ontime-vrjj.onrender.com/api/v1/",""),d=4e3,l=new AbortController;function c(p,h){r({type:"set",id:s,message:p,color:h}),setTimeout(()=>{r({type:"deleted",id:s})},5e3)}const m=setTimeout(()=>{c(a+" timed out","purple"),l.abort("Fetch timed out. "+a)},e.timeout||d);e.signal&&e.signal.addEventListener("abort",()=>{c(a+" cancelled","red"),l.abort(e.signal.reason),clearTimeout(m)},{signal:l.signal}),r({type:"set",id:s,message:a});let u;try{u=await fetch(o,{...e,signal:l.signal}).then(p=>(c(a+" OK","green"),p))}finally{clearTimeout(m)}return u}function Nt({children:e}){const[n,r]=x.useReducer(Ct,new Map);return t.jsx(te.Provider,{value:n,children:t.jsx(Se.Provider,{value:r,children:e})})}function I(){const e=x.useContext(te),n=x.useContext(Se);return r=>o=>typeof r=="function"?se(r(o),e,n).then(s=>s.json()):se({...r,signal:o.signal},e,n).then(s=>s.json())}const A=console.log.bind(console);function $t({email:e,password:n}){return{resource:"https://ontime-vrjj.onrender.com/api/v1/login",method:"POST",body:JSON.stringify({email:e,password:n}),headers:{"Content-Type":"application/json; charset=utf-8"},credentials:"include"}}function Rt({email:e,password:n,name:r}){return{resource:"https://ontime-vrjj.onrender.com/api/v1/register",method:"POST",body:JSON.stringify({email:e,password:n,name:r}),headers:{"Content-Type":"application/json; charset=utf-8"},credentials:"include"}}function Tt({name:e,setName:n,sending:r,invalid:o}){const s=x.useRef(null);return x.useEffect(()=>{s.current.focus()},[]),t.jsx(D,{inputRef:s,label:"display name",variant:"standard",disabled:r,error:o,defaultValue:e,onChange:i=>{n(i.target.value)}})}const Ft=function({onIdentify:e,signInRef:n}){const r=I(),[o,s]=x.useState("Demo Account"),[i,a]=x.useState("123"),[d,l]=x.useState(""),[c,m]=x.useState(!1),[u,p]=x.useState(!1),h=O(),j=E({mutationFn:r($t),onSuccess:(g,R,N)=>{if(g.error){A("⚠️ Server reported error: ",g.error),p(!0);return}A("☢️🙂 Mutation succeeded with data: ",g),e(g)},onError:(g,R,N)=>{A("☢️😡 Mutation failed with error: ",g)},retry:2}),y=E({mutationFn:r(Rt),onSuccess:g=>{if(g.error){if(console.log("Error in server response: ",g.error),g.error==="email already in use.")p(!0);else throw Error("Server unavailable");return}console.log("registration mutation succeeded, data=",g),e(g)},onError:g=>{console.log("registration mutation failed, error",g)},retry:2}),f=j.status==="loading"||y.status==="loading";let S=t.jsx(t.Fragment,{});return c?S=t.jsxs($,{spacing:4,pt:4,children:[t.jsx(C,{type:"submit",variant:"contained",disabled:f,color:"secondary",onClick:()=>y.mutate({email:o,password:i,name:d}),children:t.jsx(V,{spin:f,text:"Register Now"})}),y.status==="error"&&"Server unavailable. Try again?",t.jsx(C,{variant:"text",disabled:f,color:"primary",onClick:()=>{m(!1),p(!1)},children:"Go Back"})]}):S=t.jsxs($,{spacing:2,children:[t.jsx(C,{type:"submit",variant:"contained",disabled:f,onClick:()=>j.mutate({email:o,password:i}),children:t.jsx(V,{spin:f,text:"Login"})}),j.status==="error"&&"Server unavailable. Try again?",t.jsx(re,{sx:{mb:3,mt:3,color:h.palette.divider},children:"OR"}),t.jsx(C,{variant:"contained",disabled:f,color:"secondary",onClick:()=>{m(!0),p(!1)},children:"Register"})]}),t.jsx(Z,{elevation:1,sx:{py:6,px:2,mb:8,flexGrow:1,minWidth:[240,300],maxWidth:450,ml:"auto",mr:["auto",0]},children:t.jsx("form",{onSubmit:g=>g.preventDefault(),children:t.jsxs(Q,{children:[t.jsx(w,{variant:"h4",component:"h2",sx:{mb:1},children:c?"Register":"Sign In"}),t.jsx(re,{sx:{mb:6}}),t.jsxs($,{spacing:6,children:[t.jsx(D,{inputRef:n,label:"email",helperText:u&&c?"Already in use.":" ",variant:"standard",disabled:f,error:u,defaultValue:o,onChange:g=>{s(g.target.value),p(!1)}}),t.jsx(D,{label:"password",variant:"standard",type:"password",helperText:u&&!c?"Invalid email or password.":" ",disabled:f,error:u,defaultValue:i,onChange:g=>{a(g.target.value),p(!1)}}),c&&t.jsx(Tt,{name:d,setName:l,sending:f,invalid:u}),S]})]})})})},Lt="/assets/notebook-unsplash-8fbbce77.jpg";function be({show:e,onRetry:n,message:r}){if(e)return t.jsx(Q,{maxWidth:"sm",children:t.jsx(Ge,{severity:"error",sx:{mt:4},action:t.jsx(C,{onClick:n,sx:{ml:2,mt:-.5},children:"Retry"}),children:t.jsx("span",{children:r||"Failed to load. Please try again later."})})})}const b=console.log.bind(console);function Dt(e){return{resource:`https://ontime-vrjj.onrender.com/api/v1/users/${e}/notebook`,credentials:"include"}}function Et(e){return{resource:`https://ontime-vrjj.onrender.com/api/v1/notes/${e}`,credentials:"include"}}function Ot(e){return{resource:`https://ontime-vrjj.onrender.com/api/v1/notes/${e.note_id}`,method:"PUT",body:JSON.stringify(e),headers:{"Content-Type":"application/json; charset=utf-8"},credentials:"include"}}function It({key:e,title:n,content:r,uid:o}){return{resource:`https://ontime-vrjj.onrender.com/api/v1/users/${o}/notebook`,method:"POST",body:JSON.stringify({key:e,title:n,content:r}),headers:{"Content-Type":"application/json; charset=utf-8"},credentials:"include"}}function Wt(e){return{resource:`https://ontime-vrjj.onrender.com/api/v1/notes/${e}`,method:"DELETE",credentials:"include"}}function _t({uid:e,name:n,email:r}){const o=B(),s=I(),[i,a]=x.useState("note list"),[d,l]=x.useState(""),[c,m]=x.useState(""),u=Y({queryKey:["note list",e],queryFn:s(Dt(e)),staleTime:30*1e3,placeholderData:()=>{if(sessionStorage["noteList-"+e])return JSON.parse(sessionStorage["noteList-"+e])}}),{mutate:p}=E({mutationFn:s(Wt),onSuccess:(y,f)=>{o.setQueryData(["note list",e],S=>S.filter(g=>g.note_id!==f))},onSettled:()=>{o.invalidateQueries({queryKey:["note list",e]})},retry:2}),h=u.data||[];x.useEffect(()=>{u.data&&!u.data.error&&(sessionStorage["noteList-"+e]=JSON.stringify(u.data))},[e,u.data]);let j=t.jsx(t.Fragment,{});switch(i){case"edit note":j=t.jsx(Qt,{id:d,title:c,onReturn:()=>a("note list")});break;default:j=t.jsx(t.Fragment,{children:h.error?h.error:t.jsx(Pt,{uid:e,notes:h,onExpand:y=>{a("edit note"),l(y),m(h.find(f=>f.note_id===y).title)},onDelete:p,onNew:async y=>{if(await o.cancelQueries({queryKey:["note list",e]}),h.some(f=>f.note_id===y.note_id))return b("🌸 Already had note in list.");o.setQueryData(["note list",e],f=>[...f,y])}})})}return t.jsxs(t.Fragment,{children:[t.jsx(he,{open:u.status==="loading",sx:{zIndex:y=>y.zIndex.drawer+1},children:t.jsx(X,{})}),t.jsx(be,{show:u.status!=="loading"&&!u.data,onRetry:u.refetch}),j]})}function Pt({uid:e,notes:n,onExpand:r,onNew:o,onDelete:s}){const i=B(),a=I(),d=E({mutationFn:a(c=>(b("check: using idem key: ",c),It({uid:e,key:c,title:"New note",content:""}))),onSuccess:c=>{if(b("Mutation outcome: ",c),!c.error){try{sessionStorage.idempotentKey=crypto.randomUUID()}catch{sessionStorage.idempotentKey=(Math.random()*1e12).toFixed()}o(c)}},retry:2}),l=n.map(c=>{const m=JSON.parse(sessionStorage["note-"+c.note_id]||"{}");return t.jsx(q,{item:!0,children:t.jsx(zt,{title:m.title||c.title,summary:m.content?t.jsx("em",{children:"Unsaved draft"}):c.summary,deleting:c.deleting,onExpand:()=>r(c.note_id),onDelete:()=>{b("deleting ",c.note_id),s(c.note_id),i.setQueryData(["note list",e],u=>u.map(p=>p.note_id!==c.note_id?p:{...p,title:"Deleting...",deleting:!0}))},draft:!!sessionStorage["note-"+c.note_id]})},c.note_id)});return l.push(t.jsx(q,{item:!0,children:t.jsx(Gt,{disabled:d.isLoading,onCreate:()=>{d.mutate(sessionStorage.idempotentKey)}})},"create")),t.jsxs(K,{elevation:0,sx:{mt:6,p:4},children:[t.jsx(w,{variant:"h4",mb:4,children:"My Notebook"}),l.length?t.jsx(q,{container:!0,spacing:4,children:l}):t.jsx(t.Fragment,{children:"No notes yet."})]})}function Gt({onCreate:e,disabled:n}){const r=O(),o=we(),s=n?r.palette.primary.dark:r.palette.primary.main,i=n?.2:1,a={width:"100px",height:"100px",opacity:i},d=n?t.jsx("div",{style:{width:"100px",height:"100px",display:"grid",placeItems:"center"},children:t.jsx(X,{})}):t.jsx(Qe,{sx:a});return t.jsx(K,{sx:{width:o,height:300,borderLeft:`4px solid ${s}`},elevation:4,children:t.jsxs(fe,{disabled:n,onClick:e,sx:{height:"100%",display:"flex",flexDirection:"column"},children:[d,t.jsx(ve,{children:t.jsx(w,{variant:"h6",sx:{mb:"1rem",opacity:i},children:n?"Creating...":"New note"})})]})})}function we(){return me("(max-width: 320px)")?176:240}function zt({title:e,summary:n,deleting:r,draft:o,onExpand:s,onDelete:i}){const a=O(),d=we();let l=o?a.palette.warning.main:a.palette.primary.main;return r&&(l=a.palette.primary.dark),t.jsxs(K,{sx:{width:d,height:300,borderLeft:`4px solid ${l}`,display:"flex",flexDirection:"column",justifyContent:"space-between",opacity:r?.2:1,transition:"opacity 0.5s ease-out"},elevation:4,children:[t.jsxs(fe,{onClick:s,disabled:r,children:[t.jsx(Xe,{component:"img",height:"100",image:Lt,alt:""}),t.jsxs(ve,{children:[t.jsx(w,{variant:"h6",sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e}),n]})]}),!r&&t.jsxs(ze,{children:[t.jsx(C,{size:"small",onClick:s,sx:{color:l},children:o?"Unsaved":"Expand"}),t.jsx(L,{ml:"auto",children:t.jsx(ge,{"aria-label":"Delete",onClick:i,children:t.jsx(Le,{sx:{color:l}})})})]})]})}function Qt({id:e,title:n,onReturn:r}){const o=sessionStorage["note-"+e]?JSON.parse(sessionStorage["note-"+e]):void 0,s=I(),i=Y({queryKey:["note",e],queryFn:s(Et(e)),staleTime:30*1e3,initialData:o,enabled:!o}),a=i.data;let d=t.jsx(t.Fragment,{});return i.status==="loading"&&(d=t.jsxs($,{spacing:4,children:[t.jsx(D,{disabled:!0,label:"Title",value:n,sx:{width:"100%"}}),t.jsxs("div",{children:[t.jsx(U,{variant:"text",width:"70%"}),t.jsx(U,{variant:"text",width:"80%"}),t.jsx(U,{variant:"text",width:"60%"})]})]})),a&&(d=t.jsx(Bt,{id:e,initialTitle:a.title,initialContent:a.content})),a&&a.error&&(d=t.jsxs(t.Fragment,{children:["Permission error: ",a.error]})),t.jsxs(K,{elevation:0,sx:{mt:6,px:2,py:2},children:[t.jsxs(Z,{elevation:1,sx:{py:2,px:2},children:[t.jsx(w,{variant:"h4",mb:4,children:"Edit Note"}),t.jsxs(L,{minHeight:100,width:"min(90%,80ch)",children:[t.jsx(w,{variant:"body",children:d}),t.jsx(be,{show:!a&&i.status!=="loading",onRetry:i.refetch})]})]}),t.jsx(C,{onClick:r,sx:{mt:4},children:"Back to List"})]})}function Bt({id:e,initialTitle:n,initialContent:r}){const o=x.useRef(null),s=B(),i=I(),[a,d]=x.useState(n||""),[l,c]=x.useState(r||""),[m,u]=x.useState(""),[p,h]=x.useState(!!sessionStorage["note-"+e]),[j,y]=x.useState(!1),f=E({mutationFn:i(Ot),onMutate:()=>y(!1),onSuccess:v=>{if(v.error){b("🤒 Failed to save:",v.error),y(!0),s.refetchQueries({queryKey:["heartbeat"]});return}b("😊 Mutation succeeded: ",v),v.title===a&&v.content===l?(b("✅ saved record matches current state"),sessionStorage.removeItem("note-"+e),h(!1)):b("⚠️ but saved record is behind current version"),s.setQueryData(["note",e],v),u(new Date().toLocaleTimeString()),s.invalidateQueries(["note list"])},onError:v=>{b("😢 Mutation failed: ",v)},retry:2}),S=f.mutate;x.useEffect(()=>{b("draft-check mutation triggered"),sessionStorage["note-"+e]&&(b("Sending stored draft..."),S({note_id:e,title:n,content:r}))},[S,e,n,r]);const g=De("put",v=>{S({note_id:e,...v})},3e3);function R({title:v,content:P}){sessionStorage["note-"+e]=JSON.stringify({title:v,content:P})}let N="success.main";p&&(N="warning.main"),j&&(N="error.main");let T="Saved";return p&&(T="Unsaved"),f.isLoading&&(T="Autosaving..."),t.jsxs($,{spacing:4,children:[t.jsx(D,{label:"Title",value:a,onChange:v=>{h(!0),d(v.target.value),R({title:v.target.value,content:l}),g({title:v.target.value,content:l})},sx:{width:"100%"},inputRef:o}),t.jsx(D,{label:"Content",value:l,onChange:v=>{h(!0),c(v.target.value),R({title:a,content:v.target.value}),g({title:a,content:v.target.value})},sx:{width:"100%"},minRows:5,maxRows:15,id:"outlined-textarea",multiline:!0}),t.jsxs(L,{sx:{display:"flex",justifyContent:"end"},children:[t.jsx(w,{variant:"caption",color:N,children:T}),t.jsx(w,{variant:"caption",children:m&&!f.isLoading&&(p?t.jsxs(t.Fragment,{children:[" since ",m]}):t.jsxs(t.Fragment,{children:[" at: ",m]}))})]})]})}const k=console.log.bind(console),J=new Be({queryCache:new Ke({onSuccess:e=>{if(e.error&&(e.error==="No identification provided."||e.error==="Token expired.")&&(k("🦆 Cookie expired"),J.setQueryData(["heartbeat"],"")),e.exp&&localStorage.lastLogin){const n=JSON.parse(localStorage.lastLogin);k("🪦 Got new expiry. Updating ",n.expires," to ",e.exp*1e3,` (${(e.exp*1e3-n.expires)/1e3}s later)`),localStorage.lastLogin=JSON.stringify({...n,expires:e.exp*1e3})}}}),mutationCache:new Ue({onSettled:e=>{e.error&&(e.error==="No identification provided."||e.error==="Token expired.")&&(k("Looks like we've logged out."),J.setQueryData(["heartbeat"],""))}})}),Kt={resource:"https://ontime-vrjj.onrender.com/api/v1/login",method:"DELETE",credentials:"include"},Ut={resource:"https://ontime-vrjj.onrender.com/api/v1/me",credentials:"include"};function qt(){return t.jsx(xe,{theme:Ee,children:t.jsx(Oe,{children:t.jsx(Ie,{client:J,children:t.jsxs(Nt,{children:[t.jsx(kt,{}),t.jsx(Vt,{})]})})})})}function At(){return t.jsx(t.Fragment,{children:t.jsx(L,{sx:{position:"absolute",top:"0px",backgroundImage:[`url(${wt})`,`url(${bt})`],backgroundSize:["135vh","cover"],backgroundPosition:"center",height:["90vh","max(20rem, 55vh)"],width:"100%",zIndex:-1}})})}function Vt(){const[n,r]=x.useState(()=>{const p=JSON.parse(localStorage.lastLogin||"{}");return Date.now()<p.expires?(k("Using stored login: ",p),p):(k("stored login missing or expired: ",p),null)}),o=O(),s=I(),i=B(),a=x.useRef(null),d=Y({queryKey:["heartbeat"],queryFn:s(Ut),placeholderData:n||{notice:"Awaiting login."},staleTime:6e4,enabled:!!n}),l=d.data.notice==="Awaiting login."?"":d.data,c=E({mutationFn:s(Kt),onSuccess:async()=>{k(">> logout success..."),await i.cancelQueries(),i.invalidateQueries(),i.setQueryData(["heartbeat"],""),sessionStorage.clear(),localStorage.removeItem("lastLogin"),r(null)},retry:3});async function m(p){await i.cancelQueries({queryKey:["heartbeat"]}),i.removeQueries({queryKey:["note list"]}),i.removeQueries({queryKey:["note"]}),i.setQueryData(["heartbeat"],p);const h=Date.now();localStorage.lastLogin=JSON.stringify({...p,expires:h+p.ttl}),r(JSON.parse(localStorage.lastLogin)),k("setting lastlogin=",JSON.parse(localStorage.lastLogin));try{sessionStorage.idempotentKey=crypto.randomUUID()}catch{sessionStorage.idempotentKey=(Math.random()*1e12).toFixed()}k("🔑 set idempotent key = ",sessionStorage.idempotentKey)}let u=t.jsx(t.Fragment,{});return l?u=t.jsx(_t,{...l}):u=t.jsxs($,{direction:"row",mt:4,sx:{flexWrap:"wrap"},children:[t.jsxs("h1",{style:{fontSize:"3.25rem",lineHeight:"1.35em",letterSpacing:"-0.02em",marginRight:"1em"},children:["Scribble notes.",t.jsx("br",{}),"Test this placeholder app."]}),t.jsx(Ft,{signInRef:a,onIdentify:m})]}),t.jsxs(t.Fragment,{children:[t.jsx(St,{user:l,onLogout:c.mutate,onGetStarted:()=>{a.current.scrollIntoView(),a.current.focus()},isLoggingOut:c.status==="loading"}),t.jsx(At,{}),t.jsx(Q,{maxWidth:"lg",children:u}),t.jsx(he,{open:!!n&&!l,children:t.jsx(Z,{elevation:5,sx:{p:3,borderLeft:`4px solid ${o.palette.primary.main}`},children:t.jsxs($,{children:[t.jsx("div",{children:"You have been logged out due to inactivity."}),t.jsx(C,{variant:"outlined",tabIndex:1,sx:{mx:"auto",mt:"10px",width:"150px"},onClick:p=>{p.preventDefault(),k("user=",l),localStorage.removeItem("lastLogin"),r(null)},children:"OK"})]})})}),t.jsx(ht,{initialIsOpen:!1})]})}We.createRoot(document.getElementById("root")).render(t.jsx(_e.StrictMode,{children:t.jsx(qt,{})}));
